<!-- 你的輸入欄位（示意） -->
<input id="nameInput" placeholder="請輸入姓名" />
<input id="idInput" placeholder="學號將自動帶出" readonly />

<button id="submitBtn">送出</button>
<script>
  const GAS_URL = '你的_GAS_WebApp_URL';
  const FORM_RESPONSE_URL = '你的_formResponse_URL';
  const ENTRY_NAME = 'entry.姓名那一題的ID'; // 例如 entry.123456789
  const ENTRY_ID   = 'entry.學號那一題的ID'; // 例如 entry.987654321

  const nameInput = document.querySelector('#nameInput');
  const idInput   = document.querySelector('#idInput');

  async function fetchIdByName(name) {
    const resp = await fetch(GAS_URL, {
      method: 'POST',
      body: new URLSearchParams({ name })
    });
    return resp.json();
  }

  nameInput.addEventListener('change', async () => {
    const name = nameInput.value.trim();
    if (!name) {
      idInput.value = '';
      return;
    }
    try {
      const data = await fetchIdByName(name);
      if (data.id) {
        idInput.value = data.id;
      } else if (data.error === 'DUPLICATE') {
        idInput.value = '';
        alert(`找到 ${data.count} 筆同名，請再加上班級或其他辨識資訊。`);
      } else {
        idInput.value = '';
        alert('找不到這個姓名，請確認。');
      }
    } catch (e) {
      console.error(e);
      alert('查詢失敗，請稍後再試');
    }
  });

  document.querySelector('#submitBtn').addEventListener('click', async () => {
    const name = nameInput.value.trim();
    const id = idInput.value.trim();

    if (!name || !id) {
      alert('請先輸入姓名並讓系統帶出學號');
      return;
    }

    const fd = new FormData();
    fd.append(ENTRY_NAME, name);
    fd.append(ENTRY_ID, id);

    // 注意：跨網域到 Google 會報 CORS，但資料仍會進表單
    await fetch(FORM_RESPONSE_URL, { method: 'POST', mode: 'no-cors', body: fd });

    alert('已送出');
    // 可視需求清空
    // nameInput.value = ''; idInput.value = '';
  });
</script>
